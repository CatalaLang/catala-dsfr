<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Typing (catala.Shared_ast.Typing)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">catala</a> &#x00BB; <a href="../index.html">Shared_ast</a> &#x00BB; Typing</nav><header class="odoc-preamble"><h1>Module <code><span>Shared_ast.Typing</span></code></h1><p>Typing for the default calculus. Because of the error terms, we perform type inference using the classical W algorithm with union-find unification.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Env" class="anchored"><a href="#module-Env" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Env/index.html">Env</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><p>In the following functions, the <code>~leave_unresolved</code> labeled parameter controls the behavior of the typer in the case where polymorphic expressions are still found after typing: if set to <code>true</code>, it allows them (giving them <code>TAny</code> and losing typing information), if set to <code>false</code>, it aborts.</p><div class="odoc-spec"><div class="spec value" id="val-expr" class="anchored"><a href="#val-expr" class="anchor"></a><code><span><span class="keyword">val</span> expr : 
  <span>leave_unresolved:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Shared_ast__Definitions.decl_ctx</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?env:<span><span class="type-var">'e</span> <a href="Env/index.html#type-t">Env.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?typ:<span><span class="xref-unresolved">Shared_ast__Definitions.naked_typ</span> <a href="../../Catala_utils/Marked/index.html#type-pos">Catala_utils.Marked.pos</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span><span class="type-var">'m</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
      <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>,
    <span><span class="type-var">'m</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
    <a href="../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="keyword">as</span> 'e <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span><span class="xref-unresolved">Shared_ast__Definitions.typed</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
      <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>
      <span class="xref-unresolved">Bindlib</span>.box</span>,
    <span><span class="xref-unresolved">Shared_ast__Definitions.typed</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
    <a href="../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div><div class="spec-doc"><p>Infers and marks the types for the given expression. If <code>typ</code> is provided, it is assumed to be the outer type and used for inference top-down.</p><p>If the input expression already has type annotations, the full inference is still done, but with unification with the existing annotations at every step. This can be used for double-checking after AST transformations and filling the gaps (<code>TAny</code>) if any. Use <code>Expr.untype</code> first if this is not what you want.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_expr" class="anchored"><a href="#val-check_expr" class="anchor"></a><code><span><span class="keyword">val</span> check_expr : 
  <span>leave_unresolved:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Shared_ast__Definitions.decl_ctx</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?env:<span><span class="type-var">'e</span> <a href="Env/index.html#type-t">Env.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?typ:<span><span class="xref-unresolved">Shared_ast__Definitions.naked_typ</span> <a href="../../Catala_utils/Marked/index.html#type-pos">Catala_utils.Marked.pos</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span><span class="type-var">'m</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
      <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>,
    <span><span class="type-var">'m</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
    <a href="../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="keyword">as</span> 'e <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span><span class="xref-unresolved">Shared_ast__Definitions.untyped</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
      <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>
      <span class="xref-unresolved">Bindlib</span>.box</span>,
    <span><span class="xref-unresolved">Shared_ast__Definitions.untyped</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
    <a href="../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div><div class="spec-doc"><p>Same as <code>expr</code>, but doesn't annotate the returned expression. Equivalent to <code>Typing.expr |&gt; Expr.untype</code>, but more efficient. This can be useful for type-checking and disambiguation (some AST nodes are updated with missing information, e.g. any <code>TAny</code> appearing in the AST is replaced)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-program" class="anchored"><a href="#val-program" class="anchor"></a><code><span><span class="keyword">val</span> program : 
  <span>leave_unresolved:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span><span class="type-var">'m</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
      <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>,
    <span><span class="type-var">'m</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
    <a href="../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
    <span class="xref-unresolved">Shared_ast__Definitions.program</span></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span><span class="xref-unresolved">Shared_ast__Definitions.typed</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
      <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>,
    <span><span class="xref-unresolved">Shared_ast__Definitions.typed</span> <span class="xref-unresolved">Shared_ast__Definitions.mark</span></span> )</span>
    <a href="../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
    <span class="xref-unresolved">Shared_ast__Definitions.program</span></span></span></code></div><div class="spec-doc"><p>Typing on whole programs (as defined in Shared_ast.program, i.e. for the later dcalc/lcalc stages.</p><p>Any existing type annotations are checked for unification. Use <code>Program.untype</code> to remove them beforehand if this is not the desired behaviour.</p></div></div></div></body></html>