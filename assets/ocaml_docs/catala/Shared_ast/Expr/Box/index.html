<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Box (catala.Shared_ast.Expr.Box)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">catala</a> &#x00BB; <a href="../../index.html">Shared_ast</a> &#x00BB; <a href="../index.html">Expr</a> &#x00BB; Box</nav><header class="odoc-preamble"><h1>Module <code><span>Expr.Box</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#low-level-handling-of-boxed-expressions">Low-level handling of boxed expressions</a></li></ul></nav><div class="odoc-content"><h3 id="low-level-handling-of-boxed-expressions"><a href="#low-level-handling-of-boxed-expressions" class="anchor"></a>Low-level handling of boxed expressions</h3><p>This module contains helper functions for Bindlib, and wrappers to use boxed expressions.</p><p>We use the <code>boxed_expr = naked_expr box marked</code> type throughout, rather than the more straightforward <code>expr box = naked_expr marked box</code>, because the latter would force us to resolve the box every time we need to recover the annotation, which happens often. It's more efficient and convenient to add the annotation outside of the box, and delay its injection (using <code>lift</code>) to when the parent term gets built.</p><div class="odoc-spec"><div class="spec value" id="val-lift" class="anchored"><a href="#val-lift" class="anchor"></a><code><span><span class="keyword">val</span> lift : 
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
    <span class="xref-unresolved">Bindlib</span>.box</span></span></code></div><div class="spec-doc"><p>Inject the annotation within the box, to use e.g. when a <code>gexpr box</code> is required for building parent terms</p></div></div><div class="odoc-spec"><div class="spec value" id="val-app0" class="anchored"><a href="#val-app0" class="anchor"></a><code><span><span class="keyword">val</span> app0 : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div><div class="spec-doc"><p>The <code>app*</code> functions allow building boxed expressions using <code>Bindlib.apply_box</code> and its variants, while correctly handling the expression annotations. Note that the function provided as argument should return a <code>naked_gexpr</code> and the expression annotation (<code>'t</code>) is provided as a separate argument.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-app1" class="anchored"><a href="#val-app1" class="anchor"></a><code><span><span class="keyword">val</span> app1 : 
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t1</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t1</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t1</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t1</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t2</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t2</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t2</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t2</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-app2" class="anchored"><a href="#val-app2" class="anchor"></a><code><span><span class="keyword">val</span> app2 : 
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-app3" class="anchored"><a href="#val-app3" class="anchor"></a><code><span><span class="keyword">val</span> app3 : 
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-appn" class="anchored"><a href="#val-appn" class="anchor"></a><code><span><span class="keyword">val</span> appn : 
  <span><span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
    list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
      list</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-app1n" class="anchored"><a href="#val-app1n" class="anchor"></a><code><span><span class="keyword">val</span> app1n : 
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
    list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
      list</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-app2n" class="anchored"><a href="#val-app2n" class="anchor"></a><code><span><span class="keyword">val</span> app2n : 
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
    list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span><span>( <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span>, <span class="type-var">'t</span> )</span>
      <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span>
      list</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'t</span> )</span> <span class="xref-unresolved">Shared_ast__Definitions.base_gexpr</span></span> <span class="xref-unresolved">Bindlib</span>.box</span>, <span class="type-var">'t</span> )</span>
    <a href="../../../Catala_utils/Marked/index.html#type-t">Catala_utils.Marked.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fv" class="anchored"><a href="#val-fv" class="anchor"></a><code><span><span class="keyword">val</span> fv : <span><span><span class="type-var">'b</span> <span class="xref-unresolved">Bindlib</span>.box</span> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>fv</code> return the list of free variables from a boxed term.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-assert_closed" class="anchored"><a href="#val-assert_closed" class="anchor"></a><code><span><span class="keyword">val</span> assert_closed : <span><span><span class="type-var">'b</span> <span class="xref-unresolved">Bindlib</span>.box</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>assert_closed b</code> check there is no free variables in then <code>b</code> boxed term. It raises an internal error if it not the case, printing all free variables.</p></div></div></div></body></html>